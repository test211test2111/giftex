<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —à—Ä–∏—Ñ—Ç—ã -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram Widget API -->
  <script async src="https://telegram.org/js/telegram-widget.js"></script>
  
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
  <link rel="stylesheet" href="/css/style.css">
  
  <!-- –§–∞–≤–∏–∫–æ–Ω–∫–∞ -->
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
</head>
<body class="bg-telegram-white min-h-screen flex flex-col">
  <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
  <header class="bg-telegram-blue text-white p-4 shadow-md">
    <div class="container mx-auto flex justify-between items-center">
      <a href="/" class="text-2xl font-bold flex items-center">
        <span class="mr-2">üéÅ</span> GIFTEX
      </a>
      
      <nav class="flex items-center space-x-4">
        <% if (locals.user) { %>
          <a href="/profile" class="hover:underline flex items-center">
            <% if (user.photoUrl) { %>
              <img src="<%= user.photoUrl %>" alt="<%= user.firstName %>" class="w-8 h-8 rounded-full mr-2">
            <% } %>
            <%= user.firstName %>
          </a>
          <a href="/balance" class="hover:underline">–ë–∞–ª–∞–Ω—Å</a>
          <a href="/auth/logout" class="bg-white text-telegram-blue px-4 py-2 rounded-md hover:bg-gray-100 transition">–í—ã–π—Ç–∏</a>
        <% } else { %>
          <a href="/auth/telegram" class="bg-white text-telegram-blue px-4 py-2 rounded-md hover:bg-gray-100 transition">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</a>
        <% } %>
      </nav>
    </div>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
  <main class="flex-grow">
    <div class="min-h-screen flex flex-col items-center justify-center py-10 px-4">
      <div class="bg-white shadow-xl rounded-lg p-8 max-w-md w-full">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold mb-4 text-telegram-blue">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram</h1>
          <p class="text-gray-700">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Telegram –¥–ª—è –≤—Ö–æ–¥–∞</p>
        </div>
        
        <div class="flex justify-center mb-8" id="telegram-login-container">
          <!-- Telegram Login Widget –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å—é–¥–∞ —á–µ—Ä–µ–∑ JS -->
        </div>
        
        <div class="text-center text-sm text-gray-600">
          <p class="mb-4">–ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞.</p>
          <p>–ú—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –≤–∞—à –ø–∞—Ä–æ–ª—å –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∞—à–µ–≥–æ Telegram –ø—Ä–æ—Ñ–∏–ª—è.</p>
        </div>
      </div>
    </div>
  </main>

  <!-- –ü–æ–¥–≤–∞–ª —Å–∞–π—Ç–∞ -->
  <footer class="bg-telegram-gray py-4 mt-8">
    <div class="container mx-auto text-center text-gray-700">
      <p>&copy; <%= new Date().getFullYear() %> GIFTEX. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      <p class="mt-2 text-sm">–≠—Ç–æ—Ç —Å–∞–π—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º Telegram.</p>
    </div>
  </footer>

  <!-- –û–±—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã -->
  <script src="/js/app.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const container = document.getElementById('telegram-login-container');
      
      // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ Telegram Login
      const script = document.createElement('script');
      script.async = true;
      script.src = 'https://telegram.org/js/telegram-widget.js';
      script.setAttribute('data-telegram-login', '<%= botUsername %>');
      script.setAttribute('data-size', 'large');
      script.setAttribute('data-radius', '8');
      script.setAttribute('data-request-access', 'write');
      script.setAttribute('data-userpic', 'true');
      script.setAttribute('data-onauth', 'onTelegramAuth(user)');
      
      container.appendChild(script);
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      window.onTelegramAuth = function(user) {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        fetch('/auth/telegram/callback', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(user)
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            window.location.href = data.redirectUrl;
          } else {
            alert('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
          }
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
          alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.');
        });
      };
    });
  </script>
</body>
</html> 